<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Anime Saya</title>
  <style>
    :root {
      --primary: #6200ee;
      --primary-dark: #3700b3;
      --background: #f5f5f5;
      --card: #ffffff;
      --text: #333333;
      --border: #e0e0e0;
    }
    .dark-mode {
      --primary: #bb86fc;
      --primary-dark: #3700b3;
      --background: #121212;
      --card: #1e1e1e;
      --text: #e0e0e0;
      --border: #333333;
    }
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: var(--background);
      color: var(--text);
      padding: 10px;
      margin: 0;
      line-height: 1.4;
      transition: background 0.3s, color 0.3s;
      font-size: 14px;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h1 {
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 0 10px 0;
    }
    #daftar-anime {
      margin-top: 10px;
    }
    .anime-card {
      background: var(--card);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
      transition: all 0.3s;
    }
    .anime-header {
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .anime-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .anime-title.expanded {
      white-space: normal;
      overflow: visible;
      text-overflow: initial;
    }
    .anime-detail {
      padding: 0 10px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }
    .anime-detail.active {
      padding: 8px 10px;
      max-height: 500px;
    }
    .anime-cover {
      width: 100%;
      max-height: 150px;
      object-fit: contain;
      margin-bottom: 8px;
      border-radius: 3px;
    }
    .anime-description {
      white-space: pre-line;
      max-height: 150px;
      overflow-y: auto;
      padding-right: 5px;
      font-size: 13px;
    }
    .anime-description::-webkit-scrollbar {
      width: 4px;
    }
    .anime-description::-webkit-scrollbar-track {
      background: var(--background);
    }
    .anime-description::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 2px;
    }
    .action-buttons {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }
    button:hover {
      background: var(--primary-dark);
    }
    button.secondary {
      background: #666;
    }
    button.danger {
      background: #d32f2f;
    }
    #add-form, #import-export-form, #search-form {
      background: var(--card);
      padding: 12px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 10px;
      display: none;
      border: 1px solid var(--border);
    }
    #add-form.active, #import-export-form.active, #search-form.active {
      display: block;
    }
    input, textarea {
      width: 100%;
      padding: 6px 8px;
      margin-bottom: 8px;
      border: 1px solid var(--border);
      border-radius: 3px;
      box-sizing: border-box;
      background: var(--card);
      color: var(--text);
      transition: all 0.3s;
      font-size: 13px;
    }
    textarea {
      min-height: 70px;
      resize: vertical;
    }
    .icon-button {
      background: transparent;
      color: var(--primary);
      font-size: 1.1rem;
      padding: 0;
      width: 26px;
      height: 26px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mode-toggle {
      position: fixed;
      bottom: 15px;
      right: 15px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      box-shadow: 0 1px 5px rgba(0,0,0,0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      z-index: 100;
    }
    .github-status {
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
      margin-top: 5px;
    }
    @media (min-width: 600px) {
      body {
        max-width: 600px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>

<h1>
  Daftar Anime Saya
  <div class="header-actions">
    <button class="icon-button" onclick="toggleSearchForm()">üîç</button>
    <button class="icon-button" onclick="toggleImportExportForm()">üìÅ</button>
    <button class="icon-button" onclick="toggleForm()">+</button>
  </div>
</h1>

<div id="search-form">
  <h2>Cari Anime</h2>
  <input type="text" id="search-input" placeholder="Masukkan judul anime..." oninput="searchAnime()">
  <div class="action-buttons">
    <button class="secondary" onclick="toggleSearchForm()">Tutup</button>
  </div>
</div>

<div id="add-form">
  <h2>Tambah Anime Baru</h2>
  <input type="text" id="judul" placeholder="Judul Anime" required>
  <textarea id="deskripsi" placeholder="Deskripsi (bisa multi-baris)"></textarea>
  <input type="text" id="cover-url" placeholder="URL Gambar Cover">
  <div class="action-buttons">
    <button onclick="tambahAnime()">Simpan</button>
    <button class="secondary" onclick="toggleForm()">Batal</button>
  </div>
</div>

<div id="import-export-form">
  <h2>Cloud Sync</h2>
  <div class="action-buttons">
    <button onclick="exportData()">üíæ Export Local</button>
    <button onclick="simpanKeGitHub()">‚¨ÜÔ∏è Simpan ke GitHub</button>
    <button onclick="loadDariGitHub()">‚¨áÔ∏è Load dari GitHub</button>
    <button onclick="document.getElementById('import-input').click()">üìÅ Import File</button>
    <input type="file" id="import-input" accept=".json" style="display: none;" onchange="importData(this)">
  </div>
  <textarea id="export-data" placeholder="Data JSON akan muncul di sini saat export" readonly></textarea>
  <div class="github-status" id="github-status"></div>
  <div class="action-buttons">
    <button class="secondary" onclick="toggleImportExportForm()">Tutup</button>
  </div>
</div>

<div id="daftar-anime"></div>

<button class="mode-toggle" onclick="toggleDarkMode()">üåô</button>

<script>
  // Konfigurasi GitHub (GANTI DENGAN DATA ANDA)
  const GITHUB_USERNAME = "Zhitam";
  const GITHUB_REPO = "My-Personal-anime-list";
  const token = prompt("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:"); // Dapatkan dari GitHub Settings > Developer Settings > Tokens

  // Muat anime dan mode saat halaman dibuka
  document.addEventListener("DOMContentLoaded", function() {
    muatAnime();
    loadDarkMode();
    updateGitHubStatus();
  });

  // Toggle form pencarian
  function toggleSearchForm() {
    const form = document.getElementById("search-form");
    form.classList.toggle("active");
    if (form.classList.contains("active")) {
      document.getElementById("search-input").focus();
    } else {
      document.getElementById("search-input").value = "";
      muatAnime();
    }
    document.getElementById("add-form").classList.remove("active");
    document.getElementById("import-export-form").classList.remove("active");
  }

  // Fungsi pencarian
  function searchAnime() {
    const searchTerm = document.getElementById("search-input").value.toLowerCase();
    const animeCards = document.querySelectorAll(".anime-card");
    
    animeCards.forEach(card => {
      const title = card.querySelector(".anime-title").textContent.toLowerCase();
      card.style.display = title.includes(searchTerm) ? "" : "none";
    });
  }

  // Toggle form tambah anime
  function toggleForm() {
    const form = document.getElementById("add-form");
    form.classList.toggle("active");
    document.getElementById("import-export-form").classList.remove("active");
    document.getElementById("search-form").classList.remove("active");
  }

  // Toggle form import/export
  function toggleImportExportForm() {
    const form = document.getElementById("import-export-form");
    form.classList.toggle("active");
    document.getElementById("add-form").classList.remove("active");
    document.getElementById("search-form").classList.remove("active");
    document.getElementById("export-data").value = "";
    updateGitHubStatus();
  }

  // Fungsi untuk menambah anime
  function tambahAnime() {
    const judul = document.getElementById("judul").value;
    const deskripsi = document.getElementById("deskripsi").value;
    const coverUrl = document.getElementById("cover-url").value;

    if (!judul) {
      alert("Judul anime harus diisi!");
      return;
    }

    const anime = {
      judul: judul,
      deskripsi: deskripsi,
      coverUrl: coverUrl,
      createdAt: new Date().getTime()
    };

    let daftarAnime = JSON.parse(localStorage.getItem("daftarAnime")) || [];
    daftarAnime.push(anime);
    localStorage.setItem("daftarAnime", JSON.stringify(daftarAnime));

    document.getElementById("judul").value = "";
    document.getElementById("deskripsi").value = "";
    document.getElementById("cover-url").value = "";
    toggleForm();
    muatAnime();
  }

  // Fungsi untuk menampilkan anime
  function muatAnime() {
    const daftarAnime = JSON.parse(localStorage.getItem("daftarAnime")) || [];
    const container = document.getElementById("daftar-anime");
    container.innerHTML = "";

    daftarAnime.sort((a, b) => a.judul.localeCompare(b.judul));

    daftarAnime.forEach((anime, index) => {
      const animeElement = document.createElement("div");
      animeElement.className = "anime-card";
      animeElement.innerHTML = `
        <div class="anime-header" onclick="toggleDetail(${index})">
          <div class="anime-title">${anime.judul}</div>
          <span>‚ñº</span>
        </div>
        <div class="anime-detail" id="detail-${index}">
          ${anime.coverUrl ? `<img src="${anime.coverUrl}" class="anime-cover" alt="Cover">` : ''}
          <div class="anime-description">${anime.deskripsi || 'Tidak ada deskripsi'}</div>
          <div class="action-buttons">
            <button onclick="editAnime(${index})">Edit</button>
            <button class="danger" onclick="hapusAnime(${index})">Hapus</button>
          </div>
        </div>
      `;
      container.appendChild(animeElement);
    });
  }

  // Toggle detail anime
  function toggleDetail(index) {
    const detail = document.getElementById(`detail-${index}`);
    const title = detail.previousElementSibling.querySelector(".anime-title");
    const arrow = detail.previousElementSibling.querySelector("span:last-child");
    
    detail.classList.toggle("active");
    title.classList.toggle("expanded");
    arrow.textContent = detail.classList.contains("active") ? "‚ñ≤" : "‚ñº";
  }

  // Fungsi untuk menghapus anime
  function hapusAnime(index) {
    if (!confirm("Apakah Anda yakin ingin menghapus anime ini?")) return;
    
    let daftarAnime = JSON.parse(localStorage.getItem("daftarAnime"));
    daftarAnime.splice(index, 1);
    localStorage.setItem("daftarAnime", JSON.stringify(daftarAnime));
    muatAnime();
  }

  // Fungsi untuk edit anime
  function editAnime(index) {
    const daftarAnime = JSON.parse(localStorage.getItem("daftarAnime"));
    const anime = daftarAnime[index];

    document.getElementById("judul").value = anime.judul;
    document.getElementById("deskripsi").value = anime.deskripsi;
    document.getElementById("cover-url").value = anime.coverUrl || "";

    daftarAnime.splice(index, 1);
    localStorage.setItem("daftarAnime", JSON.stringify(daftarAnime));

    toggleForm();
    muatAnime();
  }

  // Mode Malam
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
  }

  function loadDarkMode() {
    const darkMode = localStorage.getItem("darkMode") === "true";
    if (darkMode) {
      document.body.classList.add("dark-mode");
    }
  }

  // Export data lokal
  function exportData() {
    const data = localStorage.getItem("daftarAnime");
    document.getElementById("export-data").value = data;
    
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "anime-backup.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Import data lokal
  function importData(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        if (Array.isArray(data)) {
          localStorage.setItem("daftarAnime", JSON.stringify(data));
          muatAnime();
          alert("Data berhasil diimport!");
          toggleImportExportForm();
        } else {
          alert("Format file tidak valid!");
        }
      } catch (error) {
        alert("Error membaca file: " + error.message);
      }
    };
    reader.readAsText(file);
  }

  // Fungsi GitHub: Simpan ke GitHub
  async function simpanKeGitHub() {
    const data = localStorage.getItem("daftarAnime");
    if (!data || data === "[]") {
      alert("Tidak ada data untuk disimpan!");
      return;
    }

    document.getElementById("github-status").textContent = "Menyimpan ke GitHub...";
    
    try {
      const sha = await getFileSHA();
      
      const response = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/anime_data.json`,
        {
          method: "PUT",
          headers: {
            "Authorization": `token ${GITHUB_TOKEN}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            message: "Update anime data",
            content: btoa(unescape(encodeURIComponent(data))),
            sha: sha || null
          }),
        }
      );

      if (response.ok) {
        document.getElementById("github-status").textContent = "‚úÖ Data tersimpan di GitHub!";
        setTimeout(() => {
          document.getElementById("github-status").textContent = "";
        }, 3000);
      } else {
        throw new Error(await response.text());
      }
    } catch (error) {
      document.getElementById("github-status").textContent = `‚ùå Error: ${error.message}`;
    }
  }

  // Fungsi GitHub: Baca dari GitHub
  async function loadDariGitHub() {
    document.getElementById("github-status").textContent = "Memuat dari GitHub...";
    
    try {
      const response = await fetch(
        `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/anime_data.json`
      );
      
      if (!response.ok) throw new Error("File tidak ditemukan");
      
      const data = await response.json();
      
      localStorage.setItem("daftarAnime", JSON.stringify(data));
      muatAnime();
      document.getElementById("github-status").textContent = "‚úÖ Data berhasil dimuat!";
      setTimeout(() => {
        document.getElementById("github-status").textContent = "";
      }, 3000);
    } catch (error) {
      document.getElementById("github-status").textContent = `‚ùå Error: ${error.message}`;
    }
  }

  // Fungsi GitHub: Cek SHA file
  async function getFileSHA() {
    try {
      const response = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/anime_data.json`,
        {
          headers: {
            "Authorization": `token ${GITHUB_TOKEN}`
          }
        }
      );
      const data = await response.json();
      return data.sha;
    } catch {
      return null;
    }
  }

  // Fungsi GitHub: Update status
  async function updateGitHubStatus() {
    try {
      const response = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/anime_data.json`,
        {
          headers: {
            "Authorization": `token ${GITHUB_TOKEN}`
          }
        }
      );
      if (response.ok) {
        const data = await response.json();
        const lastUpdated = new Date(data.last_modified || data.commit.committer.date);
        document.getElementById("github-status").textContent = 
          `üîÑ Terakhir diupdate: ${lastUpdated.toLocaleString()}`;
      }
    } catch {
      document.getElementById("github-status").textContent = 
        "‚ÑπÔ∏è Belum ada data di GitHub";
    }
  }
</script>

</body>
</html>
